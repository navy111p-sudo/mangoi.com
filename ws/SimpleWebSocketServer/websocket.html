<!DOCTYPE html>

<meta charset="utf-8" />

<title>WebSocket Test</title>

<script language="javascript" type="text/javascript">


  function init()
  {
	document.myform.url.value = "ws://211.117.60.181:8090/"
	document.myform.inputtext.value = "Hello World!"
	document.myform.disconnectButton.disabled = true;
  }

  function doConnect()
  {
    websocket = new WebSocket(document.myform.url.value);
    websocket.onopen = function(evt) { onOpen(evt) };
    websocket.onclose = function(evt) { onClose(evt) };
    websocket.onmessage = function(evt) { onMessage(evt) };
    websocket.onerror = function(evt) { onError(evt) };
  }

  function onOpen(evt)
  {
    writeToScreen("connected\n");
  	document.myform.connectButton.disabled = true;
  	document.myform.disconnectButton.disabled = false;
  }

  function onClose(evt)
  {
    writeToScreen("disconnected\n");
  	document.myform.connectButton.disabled = false;
  	document.myform.disconnectButton.disabled = true;
  }

  function onMessage(evt)
  {
    if(evt.type=="text") {
      writeToScreen("onMessage : " + evt.data + '\n');
    }
    //console.log(evt.data);
    //var json = JSON.parse(evt.data); // 아이디, 내용 구별하기 위한 json
    //writeToScreen("onMessage : " + json.id + " : " + json.msg + '\n');

    // evt is object, and have 2 attr : id, msg
  }

  function onError(evt)
  {
    writeToScreen('error: ' + evt.data + '\n');

  	websocket.close();

  	document.myform.connectButton.disabled = false;
  	document.myform.disconnectButton.disabled = true;

  }

  // json object 를 가져와 웹소켓으로 발송
  function doSend(message)
  {
    writeToScreen(message.id + " : " + message.msg + '\n'); 
    websocket.send(message);  // json
  }

  function writeToScreen(message)
  {
    document.myform.outputtext.value += message
	document.myform.outputtext.scrollTop = document.myform.outputtext.scrollHeight;

  }

  window.addEventListener("load", init, false);


    // 아이디와 내용을 가져와 json 으로 만들어 발송함수 호출 ( json object )
   function sendText() {
    var id = document.myform.id.value;
    var message = document.myform.inputtext.value;
    
    var json = { "type": "text", "id": id, "msg": message };

		doSend( json );
   }

  function clearText() {
		document.myform.outputtext.value = "";
   }

   function doDisconnect() {
		websocket.close();
   }

  function ChangeLinkMemberID(ComputerID, LinkMemberID) {
      writeToScreen(ComputerID + " ||| " + LinkMemberID);
      websocket.send(ComputerID + " ||| " + LinkMemberID);
  }

  // 쿠키 함수 !
  function setCookie(name, value) {
      //date.setTime(date.getTime() + exp*24*60*60*1000);
      //document.cookie = namae + '=' + value + ';expires=' + date.toUTCString() + ';path=/';
      document.cookie = name + '=' + value;
  }

  function getCookie(name) {
      var value = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
      return value? value[2] : null;
  };


</script>

<div id="output"></div>

<form name="myform">
<p>
<textarea name="outputtext" rows="20" cols="50"></textarea>
</p>
<p>
  <div id="inputarea">
    계정 : <input type="text" name="id"><br>
    내용 : <textarea name="inputtext" cols="50"></textarea>
  </div>
</p>
<p>
<textarea name="url" cols="50"></textarea>
</p>
<p>
<input type="button" name=sendButton value="Send" onClick="sendText();">
<input type="button" name=clearButton value="Clear" onClick="clearText();">
<input type="button" name=disconnectButton value="Disconnect" onClick="doDisconnect();">
<input type="button" name=connectButton value="Connect" onClick="doConnect();">
</p>
<p>현재 값
    <div>
        학생 이름 : <input type="text" name="CookieMemberSocketName" value="<?=$CookieMemberSocketName?>" >
        멤버 ID : <input type="text" name="CookieMemberID" value="<?=$CookieMemberID?>" >
        링크 ID : <input type="text" name="CookieLinkMemberID" value="<?=$CookieLinkMemberID?>" >
        컴퓨터 번호 : <input type="text" name="ComputerID" value="<?=$CookieComputerID?>" >
    </div>
</p>
<hr>
<p>바꿀 값
    <form name="RegForm" method="POST">
        <div>
            컴퓨터 : <input type="text" name="ComputerID" value="0" >
            링크 : <input type="text" name="LinkMemberID" value="0" >
            <button onclick="javascript:ChangeLinkMemberID(ComputerID.value, LinkMemberID.value);">전환하기
        </div>
    </form>
</p>

</form>
</html> 

